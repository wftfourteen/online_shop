<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂïÜÂÆ∂ÁÆ°ÁêÜ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="app">
        <el-container class="admin-container">
            <el-header class="admin-header">
                <div class="header-content">
                    <span class="logo-link">üõí ÂïÜÂÆ∂ÁÆ°ÁêÜÂπ≥Âè∞</span>
                    <div class="header-right">
                        <el-dropdown @command="handleCommand">
                            <span class="user-info">
                                <el-avatar :src="userInfo.avatar" :size="32"></el-avatar>
                                <span style="margin-left: 8px">{{ userInfo.username }}</span>
                            </span>
                            <template #dropdown>
                                <el-dropdown-menu>
                                    <el-dropdown-item command="profile">‰∏™‰∫∫‰ø°ÊÅØ</el-dropdown-item>
                                    <el-dropdown-item divided command="logout">ÈÄÄÂá∫ÁôªÂΩï</el-dropdown-item>
                                </el-dropdown-menu>
                            </template>
                        </el-dropdown>
                    </div>
                </div>
            </el-header>
            <el-main class="admin-main" style="display: flex">
                <div class="admin-aside">
                    <el-menu :default-active="activeMenu" @select="handleMenuSelect">
                        <el-menu-item index="products">
                            <el-icon><Goods /></el-icon>
                            <span>ÂïÜÂìÅÁÆ°ÁêÜ</span>
                        </el-menu-item>
                        <el-menu-item index="orders">
                            <el-icon><List /></el-icon>
                            <span>ËÆ¢ÂçïÁÆ°ÁêÜ</span>
                        </el-menu-item>
                    </el-menu>
                </div>
                <div class="admin-content">
                    <!-- ÂïÜÂìÅÁÆ°ÁêÜ -->
                    <div v-if="activeMenu === 'products'">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px">
                            <h2>ÂïÜÂìÅÁÆ°ÁêÜ</h2>
                            <el-button type="primary" @click="showProductDialog">Ê∑ªÂä†ÂïÜÂìÅ</el-button>
                        </div>
                        <el-table :data="products" v-loading="loading">
                            <el-table-column prop="productId" label="ID" width="80"></el-table-column>
                            <el-table-column prop="name" label="ÂïÜÂìÅÂêçÁß∞"></el-table-column>
                            <el-table-column prop="price" label="‰ª∑Ê†º" width="100">
                                <template #default="{row}">¬•{{ row.price.toFixed(2) }}</template>
                            </el-table-column>
                            <el-table-column prop="stock" label="Â∫ìÂ≠ò" width="100"></el-table-column>
                            <el-table-column prop="status" label="Áä∂ÊÄÅ" width="100">
                                <template #default="{row}">
                                    <el-tag :type="row.status === 1 ? 'success' : 'info'">
                                        {{ row.status === 1 ? '‰∏äÊû∂' : '‰∏ãÊû∂' }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="200">
                                <template #default="{row}">
                                    <el-button size="small" @click="editProduct(row)">ÁºñËæë</el-button>
                                    <el-button size="small" :type="row.status === 1 ? 'warning' : 'success'" 
                                        @click="toggleStatus(row)">
                                        {{ row.status === 1 ? '‰∏ãÊû∂' : '‰∏äÊû∂' }}
                                    </el-button>
                                    <el-button size="small" type="danger" @click="deleteProduct(row.productId)">Âà†Èô§</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                    
                    <!-- ËÆ¢ÂçïÁÆ°ÁêÜ -->
                    <div v-if="activeMenu === 'orders'">
                        <h2 style="margin-bottom: 20px">ËÆ¢ÂçïÁÆ°ÁêÜ</h2>
                        <el-table :data="orders" v-loading="loading">
                            <el-table-column prop="orderId" label="ËÆ¢ÂçïÂè∑"></el-table-column>
                            <el-table-column prop="totalAmount" label="ÈáëÈ¢ù" width="100">
                                <template #default="{row}">¬•{{ row.totalAmount.toFixed(2) }}</template>
                            </el-table-column>
                            <el-table-column prop="status" label="Áä∂ÊÄÅ" width="120">
                                <template #default="{row}">
                                    <el-tag :type="getStatusType(row.status)">
                                        {{ getStatusText(row.status) }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="createdAt" label="‰∏ãÂçïÊó∂Èó¥"></el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="150">
                                <template #default="{row}">
                                    <el-button size="small" @click="viewOrder(row)">Êü•Áúã</el-button>
                                    <el-button v-if="row.status === 2" size="small" type="primary" 
                                        @click="shipOrder(row)">ÂèëË¥ß</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
            </el-main>
        </el-container>
        
        <!-- ÂïÜÂìÅÁºñËæëÂØπËØùÊ°Ü -->
        <el-dialog v-model="productDialogVisible" :title="editingProduct ? 'ÁºñËæëÂïÜÂìÅ' : 'Ê∑ªÂä†ÂïÜÂìÅ'" width="600px">
            <el-form :model="productForm" label-width="100px">
                <el-form-item label="ÂïÜÂìÅÂêçÁß∞">
                    <el-input v-model="productForm.name"></el-input>
                </el-form-item>
                <el-form-item label="‰ª∑Ê†º">
                    <el-input-number v-model="productForm.price" :min="0" :precision="2"></el-input-number>
                </el-form-item>
                <el-form-item label="Â∫ìÂ≠ò">
                    <el-input-number v-model="productForm.stock" :min="0"></el-input-number>
                </el-form-item>
                <el-form-item label="ÊèèËø∞">
                    <el-input v-model="productForm.description" type="textarea" :rows="4"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="productDialogVisible = false">ÂèñÊ∂à</el-button>
                <el-button type="primary" @click="saveProduct">‰øùÂ≠ò</el-button>
            </template>
        </el-dialog>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/element-plus/icons-vue/dist/index.iife.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/merchant.js"></script>
</body>
</html>
