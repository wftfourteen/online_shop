<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è´­ç‰©è½¦</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/dist/index.css"
    />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div id="app">
      <el-container class="app-container">
        <el-header class="app-header">
          <div class="header-content">
            <a href="./customer.html" class="logo-link">ğŸ›’ åœ¨çº¿è´­ç‰©å¹³å°</a>
            <div class="header-right">
              <el-dropdown @command="handleCommand">
                <span class="user-info">
                  <el-avatar :src="getAvatarUrl(userInfo.avatar)" :size="32"></el-avatar>
                  <span style="margin-left: 8px">{{ userInfo.username }}</span>
                </span>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="profile"
                      >ä¸ªäººä¸­å¿ƒ</el-dropdown-item
                    >
                    <el-dropdown-item command="orders"
                      >æˆ‘çš„è®¢å•</el-dropdown-item
                    >
                    <el-dropdown-item divided command="logout"
                      >é€€å‡ºç™»å½•</el-dropdown-item
                    >
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </div>
          </div>
        </el-header>
        <el-main>
          <div class="cart-container">
            <h2 style="margin-bottom: 20px">æˆ‘çš„è´­ç‰©è½¦</h2>

            <div v-loading="loading">
              <div
                v-if="cartItems.length === 0 && !loading"
                class="empty-state"
              >
                <el-empty description="è´­ç‰©è½¦æ˜¯ç©ºçš„">
                  <el-button type="primary" @click="goShopping"
                    >å»è´­ç‰©</el-button
                  >
                </el-empty>
              </div>

              <div v-else>
                <div
                  class="cart-item"
                  v-for="item in cartItems"
                  :key="item.cartId"
                >
                  <el-checkbox
                    v-model="item.selected"
                    @change="updateTotal"
                  ></el-checkbox>
                  <img
                    :src="getProductImage(item.mainImage)"
                    @error="handleImageError"
                    :alt="item.name"
                    class="cart-item-image"
                  />
                  <div class="cart-item-info">
                    <div class="cart-item-name">{{ item.name }}</div>
                    <div class="cart-item-price">
                      Â¥{{ item.price.toFixed(2) }}
                    </div>
                  </div>
                  <el-input-number
                    v-model="item.quantity"
                    :min="1"
                    :max="item.stock"
                    @change="updateQuantity(item)"
                  >
                  </el-input-number>
                  <div
                    style="
                      width: 120px;
                      text-align: right;
                      font-size: 18px;
                      font-weight: 600;
                      color: #f56c6c;
                    "
                  >
                    Â¥{{ (item.price * item.quantity).toFixed(2) }}
                  </div>
                  <el-button
                    type="danger"
                    text
                    @click="removeItem(item.cartId)"
                  >
                    <el-icon><Delete /></el-icon>
                  </el-button>
                </div>

                <div class="cart-summary">
                  <div class="summary-row">
                    <span>å·²é€‰å•†å“ {{ selectedCount }} ä»¶</span>
                    <span
                      >åˆè®¡ï¼š<strong style="font-size: 24px; color: #f56c6c"
                        >Â¥{{ totalPrice.toFixed(2) }}</strong
                      ></span
                    >
                  </div>
                  <el-button
                    type="danger"
                    size="large"
                    style="width: 100%; margin-top: 20px"
                    :disabled="selectedCount === 0"
                    @click="checkout"
                  >
                    å»ç»“ç®—
                  </el-button>
                </div>
              </div>
            </div>
          </div>
        </el-main>
      </el-container>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/cart.js"></script>
  </body>
</html>
