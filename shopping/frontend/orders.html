<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è®¢å•</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="./css/style.css">
    <style>
        .orders-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .filter-tabs {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .order-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
            margin-bottom: 16px;
        }
        .order-items {
            margin-bottom: 16px;
        }
        .order-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }
        .mini-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <el-container class="app-container">
            <el-header class="app-header">
                <div class="header-content">
                    <a href="./customer.html" class="logo-link">ğŸ›’ åœ¨çº¿è´­ç‰©å¹³å°</a>
                    <div class="header-right">
                        <div class="cart-icon" @click="goToCart">
                            <el-icon :size="24"><ShoppingCart /></el-icon>
                            <span v-if="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
                        </div>
                        <el-dropdown @command="handleCommand">
                            <span class="user-info">
                                <el-avatar :src="userInfo.avatar" :size="32"></el-avatar>
                                <span style="margin-left: 8px">{{ userInfo.username }}</span>
                            </span>
                            <template #dropdown>
                                <el-dropdown-menu>
                                    <el-dropdown-item command="profile">ä¸ªäººä¸­å¿ƒ</el-dropdown-item>
                                    <el-dropdown-item command="orders">æˆ‘çš„è®¢å•</el-dropdown-item>
                                    <el-dropdown-item divided command="logout">é€€å‡ºç™»å½•</el-dropdown-item>
                                </el-dropdown-menu>
                            </template>
                        </el-dropdown>
                    </div>
                </div>
            </el-header>
            <el-main>
                <div class="orders-container">
                    <h2 style="margin-bottom: 20px">æˆ‘çš„è®¢å•</h2>
                    
                    <div class="filter-tabs">
                        <el-radio-group v-model="filterStatus" @change="loadOrders" size="large">
                            <el-radio-button :label="null">å…¨éƒ¨</el-radio-button>
                            <el-radio-button :label="1">å¾…æ”¯ä»˜</el-radio-button>
                            <el-radio-button :label="2">å·²æ”¯ä»˜</el-radio-button>
                            <el-radio-button :label="3">å·²å‘è´§</el-radio-button>
                            <el-radio-button :label="4">å·²å®Œæˆ</el-radio-button>
                            <el-radio-button :label="5">å·²å–æ¶ˆ</el-radio-button>
                        </el-radio-group>
                    </div>
                    
                    <div v-loading="loading">
                        <div v-if="orders.length === 0 && !loading" class="empty-state">
                            <el-empty description="æš‚æ— è®¢å•">
                                <el-button type="primary" @click="goShopping">å»è´­ç‰©</el-button>
                            </el-empty>
                        </div>
                        
                        <div v-else>
                            <div v-for="order in orders" :key="order.orderId" class="order-card">
                                <div class="order-header">
                                    <div>
                                        <span style="color: #999">è®¢å•å·ï¼š</span>
                                        <span style="font-weight: 600">{{ order.orderId }}</span>
                                        <span style="margin-left: 20px; color: #999">ä¸‹å•æ—¶é—´ï¼š{{ formatDate(order.createdAt) }}</span>
                                    </div>
                                    <el-tag :type="getStatusType(order.status)">
                                        {{ getStatusText(order.status) }}
                                    </el-tag>
                                </div>
                                
                                <div class="order-items">
                                    <div v-for="item in order.items" :key="item.orderItemId || item.productId" class="order-item">
                                        <img :src="item.productImage || '/default-product.png'" :alt="item.productName" class="mini-image">
                                        <div style="flex: 1">
                                            <div style="font-weight: 600; margin-bottom: 4px">{{ item.productName }}</div>
                                            <div style="color: #999; font-size: 14px">æ•°é‡ï¼š{{ item.quantity }}</div>
                                        </div>
                                        <div style="width: 100px; text-align: right; color: #f56c6c; font-weight: 600">
                                            Â¥{{ item.subtotal.toFixed(2) }}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="order-footer">
                                    <div style="font-size: 18px; font-weight: 600">
                                        å®ä»˜é‡‘é¢ï¼š<span style="color: #f56c6c">Â¥{{ order.totalAmount.toFixed(2) }}</span>
                                    </div>
                                    <div>
                                        <el-button v-if="order.status === 1" type="danger" @click="payOrder(order.orderId)">ç«‹å³æ”¯ä»˜</el-button>
                                        <el-button v-if="order.status === 1" @click="cancelOrder(order.orderId)">å–æ¶ˆè®¢å•</el-button>
                                        <el-button v-if="order.status === 3" type="success" @click="confirmReceipt(order.orderId)">ç¡®è®¤æ”¶è´§</el-button>
                                        <el-button @click="viewDetail(order.orderId)">æŸ¥çœ‹è¯¦æƒ…</el-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </el-main>
        </el-container>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/element-plus/icons-vue/dist/index.iife.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/orders.js"></script>
</body>
</html>
