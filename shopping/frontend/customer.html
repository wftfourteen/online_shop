<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å•†å“åˆ—è¡¨ - åœ¨çº¿è´­ç‰©å¹³å°</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/dist/index.css"
    />
    <link rel="stylesheet" href="./css/style.css" />
    <style>
      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .product-container {
        margin-top: 20px;
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }
      .empty-state img {
        width: 200px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <el-container class="app-container">
        <el-header class="app-header">
          <div class="header-content">
            <a href="./customer.html" class="logo-link">ğŸ›’ åœ¨çº¿è´­ç‰©å¹³å°</a>
            <div class="header-right">
              <el-input
                v-model="searchKeyword"
                placeholder="æœç´¢å•†å“"
                style="width: 300px"
                @keyup.enter="handleSearch"
                clearable
              >
                <template #prefix>
                  <el-icon><Search /></el-icon>
                </template>
              </el-input>
              <div class="cart-icon" @click="goToCart">
                <el-icon :size="24"><ShoppingCart /></el-icon>
                <span v-if="cartCount > 0" class="cart-badge"
                  >{{ cartCount }}</span
                >
              </div>
              <el-dropdown @command="handleCommand">
                <span class="user-info">
                  <el-avatar :src="getAvatarUrl(userInfo.avatar)" :size="32"></el-avatar>
                  <span style="margin-left: 8px">{{ userInfo.username }}</span>
                  <el-icon><ArrowDown /></el-icon>
                </span>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="profile"
                      >ä¸ªäººä¸­å¿ƒ</el-dropdown-item
                    >
                    <el-dropdown-item command="orders"
                      >æˆ‘çš„è®¢å•</el-dropdown-item
                    >
                    <el-dropdown-item divided command="logout"
                      >é€€å‡ºç™»å½•</el-dropdown-item
                    >
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </div>
          </div>
        </el-header>
        <el-main class="main-content">
          <div class="filter-bar">
            <div class="filter-row">
              <span>ä»·æ ¼åŒºé—´ï¼š</span>
              <el-input-number
                v-model="filters.minPrice"
                :min="0"
                :precision="2"
                placeholder="æœ€ä½ä»·"
                style="width: 150px"
              ></el-input-number>
              <span>-</span>
              <el-input-number
                v-model="filters.maxPrice"
                :min="0"
                :precision="2"
                placeholder="æœ€é«˜ä»·"
                style="width: 150px"
              ></el-input-number>
              <span style="margin-left: 20px">æ’åºï¼š</span>
              <el-radio-group v-model="filters.sort" @change="loadProducts">
                <el-radio-button label="default">é»˜è®¤</el-radio-button>
                <el-radio-button label="price_asc">ä»·æ ¼ä½åˆ°é«˜</el-radio-button>
                <el-radio-button label="price_desc">ä»·æ ¼é«˜åˆ°ä½</el-radio-button>
              </el-radio-group>
            </div>
          </div>

          <div v-loading="loading" class="product-container">
            <div v-if="products.length === 0 && !loading" class="empty-state">
              <el-empty description="æš‚æ— å•†å“"></el-empty>
            </div>
            <div v-else class="product-grid">
              <div
                v-for="product in products"
                :key="product.productId"
                class="product-card"
                @click="goToDetail(product.productId)"
              >
                <img
                  :src="getProductImage(product.mainImage)"
                  @error="handleImageError"
                  :alt="product.name"
                  class="product-image"
                  @error="handleImageError"
                />
                <div class="product-info">
                  <div class="product-name">{{ product.name }}</div>
                  <div class="product-price">
                    Â¥{{ product.price.toFixed(2) }}
                  </div>
                  <div class="product-stock">
                    åº“å­˜: {{ product.stockStatus }}
                  </div>
                </div>
              </div>
            </div>

            <div v-if="products.length > 0" class="pagination-container">
              <el-pagination
                v-model:current-page="pagination.page"
                :page-size="pagination.pageSize"
                :total="pagination.total"
                layout="total, prev, pager, next, jumper"
                @current-change="handlePageChange"
              >
              </el-pagination>
            </div>
          </div>
        </el-main>
      </el-container>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/customer.js"></script>
  </body>
</html>
