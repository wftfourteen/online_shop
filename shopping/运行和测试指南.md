# 运行和测试指南

## 环境要求

- **Java 17** 或更高版本
- **Maven 3.6+**
- **MySQL 8.0+**
- **IDE** (推荐 IntelliJ IDEA 或 Eclipse)

## 1. 环境准备

### 1.1 检查 Java 版本

```bash
java -version
```

应该显示 Java 17 或更高版本。

### 1.2 检查 Maven 版本

```bash
mvn -version
```

### 1.3 数据库准备

1. 确保 MySQL 服务正在运行
2. 创建数据库：

```sql
CREATE DATABASE online_shop DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

3. 根据 `数据库表.md` 文件创建所需的表结构

## 2. 配置数据库连接

编辑 `src/main/resources/application.yml`，确保数据库配置正确：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/online_shop
    username: root
    password: 你的MySQL密码  # 修改为你的实际密码
```

## 3. 运行应用程序

### 方法一：使用 Maven 命令运行

在项目根目录（`shopping`）下执行：

```bash
mvn spring-boot:run
```

### 方法二：使用 IDE 运行

1. **IntelliJ IDEA**:
   - 打开项目
   - 找到 `ShoppingApplication.java` 文件
   - 右键点击 `main` 方法
   - 选择 "Run 'ShoppingApplication.main()'"

2. **Eclipse**:
   - 右键点击项目
   - 选择 `Run As` → `Spring Boot App`

### 方法三：打包后运行

```bash
# 打包项目
mvn clean package

# 运行 JAR 文件
java -jar target/shopping-0.0.1-SNAPSHOT.jar
```

### 验证运行成功

应用启动后，访问：http://localhost:1414

如果看到应用响应或错误页面（而不是连接失败），说明应用已成功启动。

查看控制台输出，应该看到类似信息：
```
Tomcat started on port(s): 1414 (http)
Started ShoppingApplication in X.XXX seconds
```

## 4. 测试

### 4.1 单元测试

运行所有单元测试：

```bash
mvn test
```

运行特定测试类：

```bash
mvn test -Dtest=ShoppingApplicationTests
```

在 IDE 中运行测试：
- 找到测试文件（如 `ShoppingApplicationTests.java`）
- 右键点击测试方法或类
- 选择 "Run Test"

### 4.2 API 接口测试

#### 使用 curl 命令测试

**1. 用户注册**
```bash
curl -X POST http://localhost:1414/register \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"testuser\",\"email\":\"test@example.com\",\"password\":\"password123\",\"role\":1}"
```

**2. 检查用户名是否可用**
```bash
curl http://localhost:1414/register/check-username?username=testuser
```

**3. 检查邮箱是否可用**
```bash
curl http://localhost:1414/register/check-email?email=test@example.com
```

**4. 用户登录**
```bash
curl -X POST http://localhost:1414/login \
  -H "Content-Type: application/json" \
  -d "{\"account\":\"testuser\",\"password\":\"password123\"}"
```

**5. 获取用户信息（需要 Token）**
```bash
curl http://localhost:1414/user \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**6. 获取商品列表**
```bash
curl "http://localhost:1414/products?page=1&pageSize=10"
```

#### 使用 Postman 测试

1. 下载并安装 [Postman](https://www.postman.com/downloads/)
2. 创建新的 Collection 命名为 "E-Commerce API"
3. 根据 `接口文档.md` 中的接口说明创建请求：
   - 设置请求方法（GET、POST、PUT 等）
   - 设置请求 URL（例如：`http://localhost:1414/register`）
   - 设置请求头（如 `Content-Type: application/json`）
   - 设置请求体（对于 POST/PUT 请求）
   - 对于需要认证的接口，在 Headers 中添加：`Authorization: Bearer <token>`

#### 使用前端页面测试

1. 打开 `frontend/index.html` 在浏览器中
2. 或者使用 Live Server 插件（在 VS Code 中）来运行前端页面
3. 确保前端配置中的 API 地址指向 `http://localhost:1414`

### 4.3 集成测试示例

创建一个完整的测试流程：

```bash
# 1. 注册新用户
curl -X POST http://localhost:1414/register \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"testuser\",\"email\":\"test@example.com\",\"password\":\"password123\",\"role\":1}"

# 2. 登录获取 Token
TOKEN=$(curl -s -X POST http://localhost:1414/login \
  -H "Content-Type: application/json" \
  -d "{\"account\":\"testuser\",\"password\":\"password123\"}" \
  | grep -o '"token":"[^"]*' | cut -d'"' -f4)

echo "Token: $TOKEN"

# 3. 使用 Token 获取用户信息
curl http://localhost:1414/user \
  -H "Authorization: Bearer $TOKEN"
```

## 5. 常见问题

### 问题1：端口 1414 已被占用

**解决方案**：
- 修改 `application.yml` 中的端口号：
  ```yaml
  server:
    port: 1415  # 改为其他端口
  ```

### 问题2：数据库连接失败

**解决方案**：
1. 确保 MySQL 服务正在运行
2. 检查 `application.yml` 中的数据库配置是否正确
3. 确保数据库 `online_shop` 已创建
4. 检查用户名和密码是否正确

### 问题3：编译错误

**解决方案**：
```bash
# 清理并重新编译
mvn clean compile

# 如果还有问题，清理 Maven 缓存并重新下载依赖
mvn clean install -U
```

### 问题4：找不到 StringConcatFactory

**解决方案**：
1. 确保项目使用的 Java 版本是 17 或更高
2. 在 IDE 中检查项目设置：
   - IntelliJ IDEA: File → Project Structure → Project SDK 设置为 Java 17
   - 刷新 Maven 项目：右键项目 → Maven → Reload Project

## 6. 开发建议

1. **日志查看**：应用日志会输出到控制台，使用 `@Slf4j` 注解的类可以记录日志
2. **数据库操作**：MyBatis 的 SQL 日志已启用，可以在控制台查看执行的 SQL 语句
3. **文件上传**：头像上传到 `./uploads/avatars` 目录（可在 `application.yml` 中配置）

## 7. 项目结构说明

```
shopping/
├── src/
│   ├── main/
│   │   ├── java/com/fourteen/
│   │   │   ├── controller/     # 控制器层
│   │   │   ├── service/        # 服务层
│   │   │   ├── mapper/         # 数据访问层
│   │   │   ├── pojo/           # 实体类
│   │   │   ├── config/         # 配置类
│   │   │   ├── filter/         # 过滤器
│   │   │   └── utils/          # 工具类
│   │   └── resources/
│   │       ├── application.yml # 应用配置
│   │       └── mapper/         # MyBatis XML 映射文件
│   └── test/                   # 测试代码
├── frontend/                   # 前端页面
└── pom.xml                     # Maven 配置
```

## 8. 下一步

- 阅读 `接口文档.md` 了解完整的 API 接口
- 阅读 `数据库表.md` 了解数据库结构
- 查看前端代码了解前端如何调用后端 API
